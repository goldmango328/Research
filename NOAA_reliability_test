Table USGS_Table;
Table NOAA_Table;
Table Miss_Table = new Table();

int check(int y1,int y2,int m1,int m2,int d1,int d2,int h1,int h2){
  if(y1==y2 && m1==m2 && d1==d2 && h1==h2){
    return 1;
  }
  else return 0;
}

void setup(){
  USGS_Table = loadTable("USGS_data.csv","header");
  NOAA_Table = loadTable("WER_2000_2017.csv","header");
  Miss_Table.addColumn("year");
  Miss_Table.addColumn("month");
  Miss_Table.addColumn("day");
  Miss_Table.addColumn("hour");
  Miss_Table.addColumn("country");
  Miss_Table.addColumn("state");
  
  int USGS_total = USGS_Table.getRowCount();
  int NOAA_total = NOAA_Table.getRowCount();
  int MATCH = 0;
  println("USGS :"+USGS_total+" NOAA :"+NOAA_total+"\n");
  for(TableRow NOAArow : NOAA_Table.rows()){
      int y = NOAArow.getInt("YEAR");
      int m = NOAArow.getInt("MONTH");
      int d = NOAArow.getInt("DAY");
      int h = NOAArow.getInt("HOUR");
      for(TableRow USGSrow : USGS_Table.rows()){
        String USGS_time = USGSrow.getString("time");
        int year = 2000+(USGS_time.charAt(2)-'0')*10+(USGS_time.charAt(3)-'0');
        int month = (USGS_time.charAt(5)-'0')*10+(USGS_time.charAt(6)-'0');
        int day = (USGS_time.charAt(8)-'0')*10+(USGS_time.charAt(9)-'0');
        
        int hour = (USGS_time.charAt(11)-'0')*10+(USGS_time.charAt(12)-'0');
        int min = (USGS_time.charAt(14)*10-'0')+(USGS_time.charAt(15)-'0');
        if(check(y,year,m,month,d,day,h,hour)==1){
          MATCH += 1;
          break;
        }
        else{
          TableRow addRow = Miss_Table.addRow();
          addRow.setInt("year",y);
          addRow.setInt("month",m);
          addRow.setInt("day",d);
          addRow.setInt("hour",h);
          addRow.setString("country",NOAArow.getString("COUNTRY"));
          addRow.setString("state",NOAArow.getString("STATE"));
        }
      }
  }
    
  println("Match :"+MATCH+" Percentage:" + (MATCH/float(NOAA_total))*100);
  println("Done!");
  saveTable(Miss_Table,"data/Missed.csv");
}
